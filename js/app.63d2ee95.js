(function(e){function t(t){for(var r,o,s=t[0],u=t[1],c=t[2],l=0,d=[];l<s.length;l++)o=s[l],a[o]&&d.push(a[o][0]),a[o]=0;for(r in u)Object.prototype.hasOwnProperty.call(u,r)&&(e[r]=u[r]);p&&p(t);while(d.length)d.shift()();return i.push.apply(i,c||[]),n()}function n(){for(var e,t=0;t<i.length;t++){for(var n=i[t],r=!0,s=1;s<n.length;s++){var u=n[s];0!==a[u]&&(r=!1)}r&&(i.splice(t--,1),e=o(o.s=n[0]))}return e}var r={},a={app:0},i=[];function o(t){if(r[t])return r[t].exports;var n=r[t]={i:t,l:!1,exports:{}};return e[t].call(n.exports,n,n.exports,o),n.l=!0,n.exports}o.m=e,o.c=r,o.d=function(e,t,n){o.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},o.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},o.t=function(e,t){if(1&t&&(e=o(e)),8&t)return e;if(4&t&&"object"===typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(o.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var r in e)o.d(n,r,function(t){return e[t]}.bind(null,r));return n},o.n=function(e){var t=e&&e.__esModule?function(){return e["default"]}:function(){return e};return o.d(t,"a",t),t},o.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},o.p="/split/";var s=window["webpackJsonp"]=window["webpackJsonp"]||[],u=s.push.bind(s);s.push=t,s=s.slice();for(var c=0;c<s.length;c++)t(s[c]);var p=u;i.push([0,"chunk-vendors"]),n()})({0:function(e,t,n){e.exports=n("56d7")},"56d7":function(e,t,n){"use strict";n.r(t);n("c5f6"),n("5df2"),n("cadf"),n("551c"),n("097d");var r=n("2b0e"),a=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{attrs:{id:"app"}},[n("h1",[e._v("Split")]),n("Persistence"),n("Matrix"),n("Expenses"),n("Refunds")],1)},i=[],o=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",[n("h2",[e._v("Expenses matrix")]),n("table",[n("tr",[n("th",[e._v("Participant")]),e._l(e.groups,function(t){return n("th",[e._v("\n                "+e._s(t.name)+"\n                "),n("button",{on:{click:function(n){e.removeGroup(t.id)}}},[e._v("X")])])}),n("th",[e._v("Total paid")]),n("th",[e._v("Personal part")]),n("th",[e._v("Balance")])],2),e._l(e.participants,function(t){return n("tr",[n("td",[e._v(e._s(t.name)+"\n                "),n("button",{on:{click:function(n){e.removeParticipant(t.id)}}},[e._v("X")])]),e._l(e.groups,function(r){return n("td",[e._v("\n                "+e._s(e._f("CHF")(e.expensesSum(t.id,r.id)))+"\n            ")])}),n("td",[e._v(e._s(e._f("CHF")(e.expensesSum(t.id,null))))]),n("td",[e._v(e._s(e._f("CHF")(e.getParticipantPart(t.id))))]),n("td",[e._v(e._s(e._f("CHF")(e.getParticipantBalance(t.id)))+"\n            ")])],2)}),n("tr",[n("th",[e._v("Total per group")]),e._l(e.groups,function(t){return n("th",[e._v(e._s(e._f("CHF")(e.expensesSum(null,t.id))))])}),n("th",[e._v(e._s(e._f("CHF")(e.expensesGrandTotal)))]),n("th",[e._v(e._s(e._f("CHF")(e.sumParts)))]),n("th",[e._v(e._s(e._f("CHF")(e.sumBalances))+" CHF")])],2)],2),n("label",{attrs:{for:"newParticipantInput"}},[e._v("New participant:")]),n("input",{directives:[{name:"model",rawName:"v-model",value:e.newParticipantName,expression:"newParticipantName"}],attrs:{id:"newParticipantInput",placeholder:"name + ENTER"},domProps:{value:e.newParticipantName},on:{keyup:function(t){if(!("button"in t)&&e._k(t.keyCode,"enter",13,t.key,"Enter"))return null;e.addParticipant()},input:function(t){t.target.composing||(e.newParticipantName=t.target.value)}}}),n("br"),n("label",{attrs:{for:"newGroupInput"}},[e._v("New group:")]),n("input",{directives:[{name:"model",rawName:"v-model",value:e.newGroupName,expression:"newGroupName"}],attrs:{id:"newGroupInput",placeholder:"name + ENTER"},domProps:{value:e.newGroupName},on:{keyup:function(t){if(!("button"in t)&&e._k(t.keyCode,"enter",13,t.key,"Enter"))return null;e.addGroup()},input:function(t){t.target.composing||(e.newGroupName=t.target.value)}}})])},s=[],u=n("c93e"),c=n("2f62"),p={data:function(){return{newParticipantName:"",newGroupName:""}},computed:Object(u["a"])({},Object(c["b"])({expensesSum:"expensesSum",getParticipantPart:"getParticipantPart",getParticipantBalance:"getParticipantBalance",expensesGrandTotal:"expensesGrandTotal",sumParts:"sumParts",sumBalances:"sumBalances"}),Object(c["c"])(["groups","participants"])),methods:{addParticipant:function(){this.newParticipantName.length>0&&this.$store.dispatch("addParticipant",this.newParticipantName),this.newParticipantName=""},removeParticipant:function(e){this.$store.dispatch("removeParticipant",e)},addGroup:function(){this.newGroupName.length>0&&this.$store.dispatch("addGroup",this.newGroupName),this.newGroupName=""},removeGroup:function(e){this.$store.dispatch("removeGroup",e)}}},l=p,d=(n("a569"),n("2877")),f=Object(d["a"])(l,o,s,!1,null,"f1110764",null);f.options.__file="Matrix.vue";var m=f.exports,v=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",[n("h2",[e._v("Expenses list")]),n("div",{staticClass:"expenses"},[n("ul",e._l(e.expenses,function(t){return n("li",[e._v("\n                "+e._s(e.getParticipant(t.participant).name)+" for "+e._s(e.getGroup(t.group).name)+' "'+e._s(t.name)+'": '+e._s(e._f("CHF")(t.amount))+"\n                "),n("button",{on:{click:function(n){e.removeExpense(t.id)}}},[e._v("X")])])})),n("form",{on:{submit:function(t){t.preventDefault(),e.createNewExpense()}}},[n("label",{attrs:{for:"newGroupInput"}},[e._v("New expense:")]),n("input",{directives:[{name:"model",rawName:"v-model.number",value:e.newExpenseForm.amount,expression:"newExpenseForm.amount",modifiers:{number:!0}}],staticStyle:{width:"40px"},attrs:{id:"newGroupInput",type:"number",step:"0.01",required:""},domProps:{value:e.newExpenseForm.amount},on:{input:function(t){t.target.composing||e.$set(e.newExpenseForm,"amount",e._n(t.target.value))},blur:function(t){e.$forceUpdate()}}}),e._v("CHF\n            "),n("select",{directives:[{name:"model",rawName:"v-model",value:e.newExpenseForm.participant,expression:"newExpenseForm.participant"}],attrs:{required:""},on:{change:function(t){var n=Array.prototype.filter.call(t.target.options,function(e){return e.selected}).map(function(e){var t="_value"in e?e._value:e.value;return t});e.$set(e.newExpenseForm,"participant",t.target.multiple?n:n[0])}}},e._l(e.participants,function(t){return n("option",{domProps:{value:t.id}},[e._v(e._s(t.name))])})),n("select",{directives:[{name:"model",rawName:"v-model",value:e.newExpenseForm.group,expression:"newExpenseForm.group"}],attrs:{required:""},on:{change:function(t){var n=Array.prototype.filter.call(t.target.options,function(e){return e.selected}).map(function(e){var t="_value"in e?e._value:e.value;return t});e.$set(e.newExpenseForm,"group",t.target.multiple?n:n[0])}}},e._l(e.groups,function(t){return n("option",{domProps:{value:t.id}},[e._v(e._s(t.name))])})),n("input",{directives:[{name:"model",rawName:"v-model",value:e.newExpenseForm.name,expression:"newExpenseForm.name"}],attrs:{placeholder:"optional"},domProps:{value:e.newExpenseForm.name},on:{input:function(t){t.target.composing||e.$set(e.newExpenseForm,"name",t.target.value)}}}),n("button",[e._v("Insert")])])])])},_=[],b={data:function(){return{newExpenseForm:{name:"",amount:"",participant:1,group:1}}},computed:Object(u["a"])({},Object(c["b"])({getGroup:"getGroup",getParticipant:"getParticipant"}),Object(c["c"])(["groups","participants","expenses"])),methods:{createNewExpense:function(){this.$store.dispatch("addExpense",this.newExpenseForm)},removeExpense:function(e){this.$store.dispatch("removeExpense",e)}}},g=b,h=Object(d["a"])(g,v,_,!1,null,null,null);h.options.__file="Expenses.vue";var x=h.exports,P=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",[n("h2",[e._v("Refunds")]),null==e.refunds.resolver?n("button",{on:{click:function(t){e.solveBalances()}}},[e._v("Settle balances")]):e._e(),null!=e.refunds.resolver?n("button",{on:{click:function(t){e.stopResolver()}}},[e._v("Stop resolution")]):e._e(),null!=e.refunds.resolver?n("small",[e._v("To be transfer: "+e._s(e._f("CHF")(e.absoluteRefundBalances)))]):e._e(),n("h3",[e._v("Needed transactions")]),n("ul",e._l(e.refunds.transactions,function(t){return n("li",[e._v("\n            "+e._s(t.id)+") From "+e._s(e.getParticipant(t.from).name)+" to "+e._s(e.getParticipant(t.to).name)+": "+e._s(e._f("CHF")(t.amount))+"\n        ")])})),n("h3",[e._v("Final balances")]),n("ul",e._l(e.refunds.balances,function(t,r){return n("li",[e._v("\n            "+e._s(e.getParticipant(r).name)+": "+e._s(e._f("CHF")(t))+"\n        ")])}))])},w=[],E={methods:{solveBalances:function(){this.$store.dispatch("startResolver",200)},stopResolver:function(){this.$store.dispatch("stopResolver")}},computed:Object(u["a"])({},Object(c["c"])(["refunds"]),Object(c["b"])({getParticipant:"getParticipant",absoluteRefundBalances:"absoluteRefundBalances"}))},y=E,O=Object(d["a"])(y,P,w,!1,null,null,null);O.options.__file="Refunds.vue";var j=O.exports,F=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",[n("button",{on:{click:function(t){e.persistData()}}},[e._v("Save")])])},G=[],N={methods:{persistData:function(){this.$store.dispatch("persistData"),window.location="?data="+this.queryString}},computed:Object(u["a"])({},Object(c["c"])(["queryString"]))},S=N,k=Object(d["a"])(S,F,G,!1,null,null,null);k.options.__file="Persistence.vue";var R=k.exports,C={name:"app",components:{Matrix:m,Expenses:x,Refunds:j,Persistence:R}},B=C,$=(n("6509"),Object(d["a"])(B,a,i,!1,null,"4686ac82",null));$.options.__file="App.vue";var T=$.exports,H=(n("7f7f"),n("8615"),n("ac6a"),n("456d"),n("8afe"));function M(e){return Math.max.apply(Math,[0].concat(Object(H["a"])(Object.keys(e))))+1}var I={addParticipant:function(e,t){var n=M(e.participants);r["a"].set(e.participants,n,{id:n,name:t})},removeParticipant:function(e,t){Object.values(e.expenses).forEach(function(n){n.participant===t&&r["a"].delete(e.expenses,n.id)}),r["a"].delete(e.participants,t)},addGroup:function(e,t){var n=M(e.groups);r["a"].set(e.groups,n,{id:n,name:t})},removeGroup:function(e,t){Object.values(e.expenses).forEach(function(n){n.group===t&&r["a"].delete(e.expenses,n.id)}),r["a"].delete(e.groups,t)},addExpense:function(e,t){var n=M(e.expenses);r["a"].set(e.expenses,n,{id:n,amount:t.amount,participant:t.participant,group:t.group,name:t.name})},removeExpense:function(e,t){r["a"].delete(e.expenses,t)},initBalances:function(e,t){e.refunds={balances:t,transactions:{}}},addTransaction:function(e,t){var n=M(e.refunds.transactions);r["a"].set(e.refunds.transactions,n,Object(u["a"])({id:n},t)),r["a"].set(e.refunds.balances,t.from,e.refunds.balances[t.from]-t.amount),r["a"].set(e.refunds.balances,t.to,e.refunds.balances[t.to]+t.amount)},addResolver:function(e,t){r["a"].set(e.refunds,"resolver",t)},clearResolver:function(e){r["a"].set(e.refunds,"resolver",null)},updateQueryString:function(e,t){r["a"].set(e,"queryString",t)}},q=I,D=(n("28a5"),n("386d"),n("eb11")),J=n.n(D);function A(e,t){var n=JSON.stringify({version:e,data:t});return J.a.compressToEncodedURIComponent(n)}function U(e){var t=J.a.decompressFromEncodedURIComponent(e);return JSON.parse(t)}function X(e,t){var n=U(t),r=n.version,a=n.data;if(e.version!==r)throw"Invalid version";return Object(u["a"])({},e,a)}function Q(){for(var e=window.location.search.substring(1),t=e.split("&"),n={},r=0;r<t.length;r++){var a=t[r].split("="),i=a[0],o=a[1];n[i]=o}return n}function z(e){var t=Object.keys(e).reduce(function(t,n){return e[t]>e[n]?t:n}),n=Object.keys(e).reduce(function(t,n){return e[t]<e[n]?t:n}),r=Math.min(Math.abs(e[n]),e[t]);return{from:t,to:n,amount:r}}var K={addParticipant:function(e,t){e.commit("addParticipant",t)},removeParticipant:function(e,t){e.commit("removeParticipant",t)},addGroup:function(e,t){e.commit("addGroup",t)},removeGroup:function(e,t){e.commit("removeGroup",t)},addExpense:function(e,t){e.commit("addExpense",t)},removeExpense:function(e,t){e.commit("removeExpense",t)},startResolver:function(e,t){var n={};Object.keys(e.state.participants).forEach(function(t){n[t]=e.getters.getParticipantBalance(t)}),e.commit("initBalances",n);var r=setInterval(function(){e.commit("addTransaction",z(e.state.refunds.balances)),e.getters.absoluteRefundBalances<2&&e.dispatch("stopResolver")},t);e.commit("addResolver",r)},stopResolver:function(e){clearTimeout(e.state.refunds.resolver),e.commit("clearResolver")},persistData:function(e){var t=A(e.state.version,{participants:e.state.participants,groups:e.state.groups,expenses:e.state.expenses});e.commit("updateQueryString",t)}},L=K,V={getParticipant:function(e){return function(t){return e.participants[t]}},getGroup:function(e){return function(t){return e.groups[t]}},expensesSum:function(e){return function(t,n){return Object.values(e.expenses).reduce(function(e,r){return null!=n&&r.group!=n||null!=t&&r.participant!=t||(e+=r.amount),e},0)}},expensesGrandTotal:function(e,t){return t.expensesSum(null,null)},getParticipantPart:function(e,t){return function(n){return t.expensesGrandTotal/Object.keys(e.participants).length}},sumParts:function(e,t){return Object.keys(e.participants).reduce(function(e,n){return e+t.getParticipantPart(n)},0)},getParticipantBalance:function(e,t){return function(e){return t.getParticipantPart(e)-t.expensesSum(e,null)}},sumBalances:function(e,t){return Object.keys(e.participants).reduce(function(e,n){return e+t.getParticipantBalance(n)},0)},absoluteRefundBalances:function(e){return Object.values(e.refunds.balances).reduce(function(e,t){return e+Math.abs(t)},0)}},W=V;r["a"].use(c["a"]);var Y={version:.1,queryString:null,participants:{},groups:{},expenses:{},refunds:{resolver:null,balances:{},transactions:{}}},Z=Q(),ee=Z["data"];ee&&(Y=X(Y,Z["data"]));var te=new c["a"].Store({strict:!1,state:Y,mutations:q,actions:L,getters:W});n("b107");r["a"].config.productionTip=!1,r["a"].filter("CHF",function(e){var t=Number.parseFloat(e).toFixed(2);return 0===e?"":t+" CHF"}),new r["a"]({el:"#app",store:te,render:function(e){return e(T)}})},"5d22":function(e,t,n){},6509:function(e,t,n){"use strict";var r=n("a8e1"),a=n.n(r);a.a},a569:function(e,t,n){"use strict";var r=n("5d22"),a=n.n(r);a.a},a8e1:function(e,t,n){},b107:function(e,t,n){}});
//# sourceMappingURL=app.63d2ee95.js.map